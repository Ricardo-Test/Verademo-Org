parameters:
  sca_output : ''

steps:
- script: vulnerabilities=`jq '.records[0].vulnerabilities' sca_output.json`
- ${{ each vulnerability in vulnerabilities }}:
  - task: CreateWorkItem@1
  inputs:
    workItemType: 'Issue'
    title: 'Veracode SCA - ${{ vulnerability.title }}'
    fieldMappings: '<ul><li>Description=An issue was detected during an SCA run</li><li>Overview: ${{ vulnerability.overview}}</li><li>VulnerabilityTypes: ${{vulnerability.vulnerabilityTypes}}</li></ul>'
    associate: true
    associationType: 'foundInBuild'
