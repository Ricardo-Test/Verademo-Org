parameters:
  json_content : ''
  
steps:
- job: read_json
      variables: 
        - name: vulnerabilities
          value: $[ json_content['jsonOutput.records.vulnerabilities'] ]
- ${{ each vulnerability in vulnerabilities }}:
  - task: CreateWorkItem@1
  inputs:
    workItemType: 'Issue'
    title: 'Veracode SCA - ${{ vulnerability.title }}'
    fieldMappings: 'Description=An issue was detected during an SCA run:\nOverview: ${{ vulnerability.overview}\nOverview: ${{ vulnerability.overview}\nVulnerabilityTypes: ${{vulnerability.vulnerabilityTypes}}'
    associate: true
    associationType: 'foundInBuild'
