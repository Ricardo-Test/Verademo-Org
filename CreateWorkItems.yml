parameters:
  json_file : ''
  
steps:
- task: JsonVarsV2@0
  name: jsonOutput
  inputs:
    jsonFilePath: '$(json_file)'
    envPathSeparator: '.'
    isOutput: true
    
- ${{ each vulnerability in json_content['jsonOutput.records.vulnerabilities'] }}:
  - task: CreateWorkItem@1
  inputs:
    workItemType: 'Issue'
    title: 'Veracode SCA - ${{ vulnerability.title }}'
    fieldMappings: 'Description=An issue was detected during an SCA run:\nOverview: ${{ vulnerability.overview}\nOverview: ${{ vulnerability.overview}\nVulnerabilityTypes: ${{vulnerability.vulnerabilityTypes}}'
    associate: true
    associationType: 'foundInBuild'
